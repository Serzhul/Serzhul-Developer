---
title: 자바스크립트 엔진과 런타임
date: 2021-03-29 23:03:69
category: javascript
thumbnail: { thumbnailSrc }
draft: false
---

# 자바스크립트 엔진이란 무엇인가?

- 자바스크립트 코드를 실행하는 프로그램을 의미한다.

Ex) `V8 Engine` : 구글 크롬 혹은 Node.JS에서 작동하는 자바스크립트 엔진.

그 외에도 각각의 브라우저마다 다른 자바스크립트 엔진이 존재한다.

- 자바스크립트 엔진이 무엇인지 정의하긴 쉽지만, 각 엔진들의 컴포넌트들과 그것들의 작동방식을 이해하는 것은 다소 어려울 수 있다.

# 자바스크립트 엔진의 구조

- 모든 자바스크립트 엔진에는 `CALL STACK` 과 `HEAP` 영역이 존재한다.
- `CALL STACK` 은 실행 컨텍스트를 사용해 실제 자바스크립트 코드가 실행되는 영역이다.
- `HEAP` 은 모든 애플리케이션에 필요한 객체들을 저장하는 비구조적 메모리 풀(`MEMORY POOL`)이다.

# Compilation VS Interpretation

### Compilation(컴파일)

우리가 흔히 컴파일 한다고 하는 의미의 Compilation은 모든 코드들이 머신코드들이 한번에 컨버팅 되고, 컴퓨터가 실행할 수 있는 바이너리 파일로 쓰여지는 것을 의미한다.

- `소스코드` ⇒(컴파일) ⇒ `포터블 파일-머신코드` ⇒ (실행) ⇒ `프로그램 동작`

### Interpretation(해석)

소스코드를 각 라인 마다 인터프리터를 통해 실행시키는 것을 의미한다.

물론 Interepretation에서도 머신코드로 컨버팅하는 작업은 수행되지만 각 라인마다 실행된다는 점이 컴파일하고는 다르다고 할 수 있다.

- `소스코드` ⇒ (라인별로 실행) ⇒ `프로그램 동작`

- 자바스크립트는 Interpreted한 언어이지만, Compile한 언어에 비해 매우 느리다는 단점이 존재한다.
- 과거에는 이런 단점이 크게 부각되진 않았지만, 현대의 자바스크립트로 만들어지는 웹 어플리케이션들로 인해서 이러한 낮은 퍼포먼스를 해결할 필요성이 대두되었다.
- 따라서 자바스크립트는 Interpreted한 언어라는 말은 옛날말이 되었고, 최신 자바스크립트 엔진은 두가지 방식을 혼용해서 사용하는 `Just-in-time(JIT) Compilation` 방식을 사용하게 되었다.

### Just-in-time(JIT) Compilation

모든 코드를 한번에 머신코드로 컨버팅하며, 그 즉시 실행한다는 특징을 갖는다.

컴파일과 비슷하지만 더 이상 포터블 파일을 실행하지 않으며, 즉시 실행된다.

- `소스코드` ⇒(컴파일) ⇒ `머신코드` ⇒ (실행) ⇒ `프로그램 동작`

# 자바스크립트 엔진 동작 순서

1. 소스코드
2. Parsing : 코드를 읽는 동작이라고 보면된다. 이때 자바스크립트는 `AST(Abstract Syntax Tree, 추상 구문 트리)` 를 호출하게 되는데, AST의 역할은 각각의 코드를 라인별로 의미있는 단위로 분리하여 각각을 구조화된 방식으로 트리에 저장한다. 이때 구문 오류도 같이 체크해준다.
3. Compilation(컴파일) : 생성된 AST를 갖고 머신코드로 컴파일 하게된다.
4. Execution(실행) : CALL STACK에서 실행된다.
5. Optimization(최적화) : 모던 자바스크립트 엔진은 코드가 실행되면 처음엔 최적화 되지 않은 버전을 만들어 일단 실행이 되도록하지만, 백그라운드에서는 최적화를 통해 보다 효율적으로 실행되는 과정이 이루어진다.

# 자바스크립트 런타임(Runtime)

- 자바스크립트 런타임이란, 자바스크립트를 사용하기 위한 모든 내용을 담고 있는 컨테이너라고 볼 수 있으며 예시로 브라우저를 들 수 있다. (자바스크립트 실행 환경이라고 불러도 무난하다)
- 따라서 런타임에는 자바스크립트 엔진이 필수적이라고 볼 수 있다.
- 그러나 엔진만 있어서는 안되며, `Web APIs` 도 런타임 구성요소에 포함이 된다.
- `Web API`는 엔진에게 필요한 기능을 제공해주며, 윈도우 객체에 접근할 수 있도록 해준다.
- 또한, 런타임 구성요소에는 `CALLBACK QUEUE` 가 포함된다.
- `CALLBACK QUEUE` 는 실행 대기중인 모든 콜백 함수들을 갖고 있는 자료구조이다. ex) 이벤트 핸들러 등
- `CALLBACK QUEUE` 의 동작방식 예시

1. 이벤트 핸들러 호출
2. 콜백 함수 호출
