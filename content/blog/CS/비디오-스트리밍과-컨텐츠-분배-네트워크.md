---
title: 비디오 스트리밍과 컨텐츠 분배 네트워크
date: 2022-04-12 11:04:76
category: CS
thumbnail: { thumbnailSrc }
draft: false
---

# 비디오 스트리밍과 컨텐츠 분배 네트워크

# 인터넷 비디오

- 스트리밍 비디오 애플리케이션에서는 미리 녹화된 비디오(영화, TV 프로그램, UCC 등)를 대상으로 한ㄴ다.
- 비디오는 서버에 저장되어 사용자가 비디오 시청을 서버에게 **온 디맨드(on-demand)로 요청한다.**
- 비디오는 이미지의 연속으로서 일반적으로 초당 24개~30개 이미지로 일정한 속도로 표시된다.
  - 압축되지 않은 디지털 인코딩된 이미지는 픽셀 단위로 구성되며, 각 픽셀은 휘도와 색상을 나타내는 여러 비트들로 인코딩된다.
  - 비디오의 중요한 특징은 압축될 수 있다는 점이며, 비디오 품질과 비트 전송률은 반비례 한다.
  - 네트워킹 측면에서 비디오의 가장 두드러진 특성은 높은 비트 전송률이다. (4K 스트리밍은 10Mbps 이상의 비트 전송율)
  - 스트리밍 비디오에서 가장 중요한 성능 척도는 평균 종단간(end-toend) 처리량이다. 연속재생을 제공하기 위해 네트워크는 압축된 비디오의 전송률 이상의 스트리밍 애플리케이션에 대한 평균 처리량을 제공해야 한다.

## HTTP 스트리밍 및 대쉬(DASH)

- HTTP 스트리밍에서 비디오는 HTTP 서버 내의 특정 URL을 갖는 일반적인 파일로 저장된다.
- 사용자가 비디오 시청을 원하면 클라이언트는 서버에게 TCP 연결을 설립하고 해당 URL에 대한 HTTP GET 요청을 발생시킨다. 그러면 서버가 프로토콜 및 트래픽 조건이 허용되는 대로 HTTP 응답 메시지 내에서 비디오 파일을 전송한다.
  - 클라이언트 쪽에서는 애플리케이션 버퍼에 전송된 바이트가 쩌장된다.이 버퍼의 바이트 수가 미리 정해진 임계값(Threshhold)을 초과하면 클라이언트 애플리케이션이 재생을 시작한다.
  - 스트리밍 비디오 애플리케이션은 클라이언트 애플리케이션 버퍼에서 주기적으로 비디오 프레임을 가져와 프레임을 압축해제 한다음 사용자의 화면에 표시한다.
- HTTP 스트리밍은 실제 적용되고 있지만, 모든 클라이언트들이 가용 대역폭 차이에도 불구하고 똑같이 인코딩 된 비디오를 전송 받는 다는 문제점을 갖고 있다.
  - 가용 대역폭의 차이는 서로 다른 클라이언트 간에 존재할 뿐 아니라 동일 클라이언트에서도 시간에 따른 차이가 발생하는 문제가 있어 이를 보완하기 위한 방식인 **DASH(Dynamic Adaptive Streaming over HTTP)**가 개발되었다.
- DASH에서 비디오는 여러 개의 서로 다른 버전으로 인코딩 되며, 각 버전은 서로 다른 비트율과 품질 수준을 갖고 있다.
  - 클라이언트는 동적으로 서로 다른 버전의 비디오를 몇 초 분량의 길이를 가지는 비디오 조각(chunk) 단위로 요청한다. (가용 대역폭이 충분할 때는 높은 비트율, 그렇지 않으면 낮은 비트율 비디오 버전)
- DASH는 서로 다른 인터넷 접속회선을 가진 클라이언트들에게 서로 다른 인코딩률을 갖는 비디오를 선택할 수 있도록 허용한다.
- DASH는 클라이언트에게 세션 유지 중에 시간에 따라 변화하는 종단간 가용 대역폭에 적응할 수 있도록 허용한다. (이동 중 접속하는 기지국 상황에 따라 가용 대역폭이 자주 변화하기 때문)
- DASH 사용 시 각 비디오 버전은 HTTP 서버에 서로 다른 URL을 갖고 저장된다. HTTP 서버는 비트율에 따른 각 버전의 URL을 제공하는 매니패스트(manifest) 파일을 갖고 있다.
  - 클라이언트는 매니패스트파일을 요청해 서버에서 제공되는 다양한 버전을 알게 되고 이후 클라이언트는 매번 원하는 버전의 비디오 조각 단위 데이터를 선택하여 HTTP GET 요청 메시지에 URL과 byte-range를 지정하여 요청한다.
  - 비디오 조각 단위 데이터를 다운로드 하는 동안 클라이언트는 측정된 수신 대역폭과 비트율 결정 알고리즘을 이용해 다음에 선택할 비디오 조각 단위 데이터 버전을 결정한다.

# 콘텐츠 분배 네트워크(CDN)

- 인터넷 비디오 회사에서 스트리밍 서비스를 제공하는 가장 단순한 방법은 단일한 거대 데이터 센터를 구축하고 모든 비디오 자료를 데이터 센터에 저장한 뒤 전 세계의 사용자에게 비디오 스트림을 데이터 센터로부터 직접 전송하는 것이다.
  - 그러나 위 방식은 3가지 문제점을 갖는다.
  1. 클라이언트가 데이터 센터로부터 지역적으로 먼 지점의 경우 서버로부터 클라이언트로의 패킷 경로는 다양한 링크와 ISP를 거치게 되고 이들 중 하나라도 비디오 소비율보다 낮은 전송용량을 갖는다면 종단간 처리율이 낮아져 안좋은 사용자 경험을 줄 수 있다. (경로가 길수록 이런 현상은 증가한다.)
  2. 인기 비디오는 같은 통신 링크로 여러 번 반복 전송될 것인데 이는 대역폭 낭비일 뿐 아니라 ISP들에게 중복 비용을 지불하게 된다.
  3. 단일한 데이터 센터를 구축하면 한 번의 장애로 전체 서비스가 중단될 수 있다.
- 거의 대부분 비디오 스트리밍 회사들은 위 같은 문제를 해결하기 위해 콘텐츠 분배 네트워크(Contents Distribution Network, CDN)을 이용한다.
  - CDN은 다수의 지점에서 분산된 서버들을 운영하며, 다른 형태의 웹 콘텐츠 데이터 복사본을 분산 서버에 저장한다. (사용자는 최선의 서비스와 사용자경험을 제공할 수 있는 지점의 CDN 서버로 연결된다.)
- CDN은 서버의 위치에 대해 두 가지 철학 중 하나를 채용하고 있다.
  **Enter Deep**
  - Akami에 의해 주창된 것으로 서버 클러스터를 세계 곳곳의 접속 네트워크에 구축함으로써 ISP의 접속 네트워크로 깊숙이 들어가는 것
  - 서버를 최대한 사용자 가까이에 위치시켜 사용자와 CDN 서버 사이의 링크 및 라우터 수를 줄이고, 사용자가 경험하는 지연시간 및 처리율을 향상시킨다. 단, 고도로 분산된 설계로 유지 관리 비용이 커진다.
    **Bring Home**
  - Limelight 및 다른 회사들에 의해 적용된 것으로 적은 수의 핵심 지점에 큰 규모의 서버 클러스터를 구축하여 ISP를 Home으로 가져오는 개념이다.
  - 접속 ISP에 연결하는 대신, 이러한 CDN들은 클러스터를 인터넷 교환지점에 배치된다.
- 서버 클러스터 위치가 정해지면 CDN은 콘텐츠 복사본을 클러스터에 저장하되, Pull 방식을 이용한다.
  - 어떤 사용자가 지역 클러스터에 없는 비디오를 요청하면, 해당 비디오를 중앙 서버나 다른 클러스터로부터 전송받아 사용자에게 서비스하는 동시에 복사본을 만들어 저장한다.

## CDN 동작

- 사용자 호스트의 웹 브라우저가 URL을 지정함으로써 특정 비디오 재생을 요청하면 CDN은 요청을 가로채 그 시점에서 클라이언트에 가장 적당한 CDN 클러스터를 선택하고, 클라이언트 요청을 해당 클러스터 서버로 연결한다.
- 대부분 CDN은 사용자 요청을 가로채고 다른 곳으로 연결하는데 DNS를 활용한다.

### 클러스터 선택 정책

- CDN 구축의 핵심 중 하나는 **클러스터 선택 정책**으로, 클라이언트를 동적으로 어떤 서버 클러스터 또는 CDN 데이터 센터로 연결하는 방식을 말한다.
  - 간단한 클러스터 정책의 하나로 클라이언트에게 지리적으로 가장 가까운 클러스터 할당 기법이 있다.
  - 현재 네트워크 트래픽 상황을 반영한 최선의 클러스터 선택을 위해 주기적으로 클러스터와 클라이언트 간 지연 및 손실 성능에 대한 **실시간 측정을 수행하기도 한다.**

---

### 참고 문헌

James F.Kurose & Keith W.Ross. (2017). 표제 : 컴퓨터 네트워킹 하양식 접근 (제7판) (최종원, 강현국, 신용태, 안상현, 유영환 & 황호영 옮김). (퍼스트북)
